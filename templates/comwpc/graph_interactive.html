{% extends "admin/base_site.html" %}

{% block extrahead %}
{{ block.super }}
<style>
    .subgraph-modal {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 80%;
        height: 80%;
        background: white;
        z-index: 10000;
        border: 2px solid #ccc;
        box-shadow: 0 0 20px rgba(0,0,0,0.3);
        overflow: auto;
    }

    .modal-content {
        padding: 20px;
        height: calc(100% - 40px);
    }

    .close-modal {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 24px;
        cursor: pointer;
        z-index: 10001;
    }

    .modal-backdrop {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        z-index: 9999;
    }
</style>
{% endblock %}

{% block content %}
<div style="margin: 20px;">
    <h1>{{ graph.name }}</h1>
    <div style="width: 100%; overflow: auto; border: 1px solid #ddd; padding: 10px;">
        {{ svg_content|safe }}
    </div>
    <div style="margin-top: 20px;">
        <a href="{% url 'admin:comwpc_graph_change' graph.id %}" class="button">Вернуться к редактированию</a>
    </div>
</div>

<!-- Модальное окно для подграфов -->
<div id="subgraph-modal" class="subgraph-modal">
    <span class="close-modal">&times;</span>
    <div class="modal-content" id="subgraph-content"></div>
</div>

<div id="modal-backdrop" class="modal-backdrop"></div>

<script>
// Функция для открытия подграфа в модальном окне
function openSubgraph(graphId) {
    // Показываем модальное окно и подложку
    const modal = document.getElementById('subgraph-modal');
    const backdrop = document.getElementById('modal-backdrop');
    const content = document.getElementById('subgraph-content');

    // Заголовок загрузки
    content.innerHTML = '<h2>Загрузка графа...</h2>';

    // Показываем элементы
    modal.style.display = 'block';
    backdrop.style.display = 'block';

    // Загружаем содержимое графа
    fetch(`/graph-visualization/${graphId}/`)
        .then(response => response.text())
        .then(data => {
            // Извлекаем только содержимое блока content
            const parser = new DOMParser();
            const doc = parser.parseFromString(data, 'text/html');
            const contentBlock = doc.querySelector('.content');

            if (contentBlock) {
                content.innerHTML = contentBlock.innerHTML;
            } else {
                content.innerHTML = '<h2>Ошибка загрузки графа</h2>';
            }
        })
        .catch(error => {
            content.innerHTML = `<h2>Ошибка: ${error.message}</h2>`;
        });
}

// Закрытие модального окна
document.querySelector('.close-modal').addEventListener('click', function() {
    document.getElementById('subgraph-modal').style.display = 'none';
    document.getElementById('modal-backdrop').style.display = 'none';
});

// Закрытие при клике на подложку
document.getElementById('modal-backdrop').addEventListener('click', function() {
    document.getElementById('subgraph-modal').style.display = 'none';
    this.style.display = 'none';
});
</script>
{% endblock %}